<div>
  <div>
    <%= render partial: "layouts/header" %>
    <%= render partial: "layouts/sidebar" %>
  </div>
  <div class="pt-[72px] pl-[184px]">
    <div class="flex justify-center gap-6 mt-10">
      <div>
        <%= button_to "シフトを作成", user_event_shifts_path(current_user.id, @event.id), method: :post, class: "block mx-auto py-4 text-center w-[400px] h-12 bg-main-blue rounded-md text-white font-bold leading-none" %>
      </div>
      <div>
        <%= button_to "シフトを削除する", remove_all_shifts_user_event_shifts_path(current_user.id, @event.id), method: :delete, class: "block mx-auto py-4 text-center w-[400px] h-12 bg-[#818181] rounded-md text-white font-bold leading-none" %>
      </div>
    </div>
    <% if (WorksSchedule.exists?(event_id: @event.id)) && (MembersSchedule.exists?(event_id: @event.id)) %>
      <div class="flex flex-col gap-16">
        <div class="mt-10 px-14">
          <div class="w-full h-[400px] overflow-scroll border-2">
            <table class="border-2">
              <tr>
                <th height="32px" class="flex border-r-2 border-line-100 border-b-2 min-w-[140px]"></th>
                <% @schedules.each do |schedule| %>
                  <th height="32px" class="bg-[#EBEBEB] border-r-2 border-line-100 border-b-2 leading-none min-w-[140px]">
                    <%= schedule.time_zone %>
                  </th>
                <% end %>
              </tr>
              <% @members.each do |member| %>
                <tr height="32px" width="140px" align="center" class="text-base font-bold border-b-2 min-w-[140px]">
                  <td class="border-r-2 border-line-100 flex justify-between gap-1 py-1 px-1">
                    <div>
                      <%= member.name %>
                    </div>
                    <div>
                      <%= Shift.where(member_id: member.id).count %>
                    </div>
                  </td>
                  <% @schedules.each do |schedule| %>
                    <% if MembersSchedule.exists?(schedule_id: schedule.id, member_id: member.id) %>
                      <td class="border-r-2 border-line-100 bg-red-500">
                        <div class="text-white font-bold">休み</div>
                      </td>
                    <% else %>
                      <% if @shifts.present? %>
                        <% if @shifts.where(schedule_id: schedule.id)&.find_by(member_id: member.id).present? %>
                          <td class="border-r-2 border-line-100">
                            <%= @works.find(@shifts.where(schedule_id: schedule.id).find_by(member_id: member.id).work_id).name %>
                          </td>
                        <% else %>
                          <td class="bg-[#818181] border-r-2 border-line-100"></td>
                        <% end %>
                      <% else %>
                        <td class="border-r-2 border-line-100"></td>
                      <% end %>
                    <% end %>
                  <% end %>
                </tr>
              <% end %>
            </table>
          </div>
        </div>
        <div class="mb-20 px-14">
          <div class="w-full h-[200px] overflow-scroll border-x-2">
            <table class="border-2">
              <tr>
                <th height="32px" class="border-r-2 border-line-100 border-b-2 min-w-[120px]"></th>
                <% @schedules.each do |schedule| %>
                  <th width="120px" height="32px" class="bg-[#EBEBEB] border-r-2 border-line-100 border-b-2 leading-none min-w-[72px]">
                    <%= schedule.time_zone %>
                    <%= schedule.id %>
                  </th>
                <% end %>
              </tr>
              <% @works.each do |work| %>
                <tr height="32px" align="center" class="text-base font-bold border-b-2 min-w-[120px]">
                  <td class="border-r-2 border-line-100">
                    <%= work.name %>
                    <%= work.id %>
                  </td>
                  <% @schedules.each do |schedule| %>
                    <% if WorksSchedule.exists?(work_id: work.id, schedule_id: schedule.id) %>
                      <td class="border-r-2 border-line-100 min-w-[120px]">
                        <% if @shifts.present? %>
                          <% if @shifts.find_by(schedule_id: schedule.id, work_id: work.id).present? %>
                            <%= Member.find(@shifts.find_by(schedule_id: schedule.id, work_id: work.id).member_id).name %>
                            <%= Member.find(@shifts.find_by(schedule_id: schedule.id, work_id: work.id).member_id).id %>
                          <% else %>
                            <td class="bg-[#818181] border-r-2 border-line-100"></td>
                          <% end %>
                        <% end %>
                      </td>
                    <% else %>
                      <td class="border-r-2 border-line-100 pb-1 bg-[#818181] min-w-[120px]"></td>
                    <% end %>
                  <% end %>
                </tr>
              <% end %>
            </table>
          </div>
        </div>
      </div>
    <% elsif (WorksSchedule.exists?(event_id: @event.id)) %>
      <div class="flex flex-col justify-center items-center w-full pt-40">
        <%= embedded_svg('fv-shift-image', class: "") %>
        <p class="mt-3 text-center text-2xl text-main-black leading-10"><span class="text-main-blue">スタッフ管理</span><br>から情報を入力してください</p>
      </div>
    <% elsif (MembersSchedule.exists?(event_id: @event.id)) %>
      <div class="flex flex-col justify-center items-center w-full pt-40">
        <%= embedded_svg('fv-shift-image', class: "") %>
        <p class="mt-3 text-center text-2xl text-main-black leading-10"><span class="text-main-blue">仕事管理</span><br>から情報を入力してください</p>
      </div>
    <% else %>
      <div class="flex flex-col justify-center items-center w-full pt-40">
        <%= embedded_svg('fv-shift-image', class: "") %>
        <p class="mt-3 text-center text-2xl text-main-black leading-10"><span class="text-main-blue"><%= link_to "スタッフ管理", user_event_members_path(current_user.id, @event.id) %>、<%= link_to "仕事管理", user_event_works_path(current_user.id, @event.id) %></span><br>から情報を入力してください</p>
      </div>
    <% end %>
  </div>
</div>
